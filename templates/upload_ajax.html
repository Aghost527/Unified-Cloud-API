{% extends 'base.html' %}
{% block head %}
		<title>UploadAjax</title>
		<script type="text/javascript">
			function UploadFile() {
				// get bucket/container name
				var g_bucket_list = document.getElementsByName("google_upload_bucket");
				for (var i = 0; i < g_bucket_list.length; i++) {
					if (g_bucket_list[i].checked) {
						var g_bucket = g_bucket_list[i].value;
						break;
					}
				}
				var a_container_list = document.getElementsByName("azure_upload_container");
				for (var i = 0; i < a_container_list.length; i++) {
					if (a_container_list[i].checked) {
						var a_container = a_container_list[i].value;
						break;
					}
				}
				var a_bucket_list = document.getElementsByName("aws_upload_bucket");
				for (var i = 0; i < a_bucket_list.length; i++) {
					if (a_bucket_list[i].checked) {
						var a_bucket = a_bucket_list[i].value;
						break;
					}
				}
				// get file element
				var fileObj = document.getElementById("file_path").files;
				// upload controller
				var FileController = "/upload/";
				// FormData
				var form = new FormData();
				form.append("google_upload_bucket", g_bucket);
				form.append("azure_upload_container", a_container);
				form.append("aws_upload_bucket", a_bucket);
				for (var i = 0; i < fileObj.length; i++) {
					form.append("file_path[]", fileObj[i]);
				}
				// XMLHttpRequest
				var xhr = new XMLHttpRequest();
				xhr.open("post", FileController, true);
				xhr.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						information.innerHTML = this.responseText;
					}
					else {
						information.innerHTML = "Running...";
					}
				}
				xhr.upload.addEventListener("progress", progressFunction, false);
				xhr.send(form);
			}
			function progressFunction(evt) {
				var progressBar = document.getElementById("progressBar");
				var percentageDiv = document.getElementById("percentage");
				if (evt.lengthComputable) {
					progressBar.max = evt.total;
					progressBar.value = evt.loaded;
					percentageDiv.innerHTML = Math.round(evt.loaded / evt.total * 100) + "%";
				}
			}
		</script>
{% endblock %}
{% block upload_button %}w3-light-blue{% endblock %}
{% block body %}
		<h1>Upload</h1>
		{% if google.startswith('N') or azure.startswith('N') or aws.startswith('N') %}
		<p>
		You should have at least 1 bucket/container in each platform.<br>
		<a class="w3-button w3-blue w3-round-large w3-hover-light-blue w3-ripple" href="/create_bucket/">Create Buckets/Containers</a>
		</p>
		{% else %}
		<p>
		Google Cloud Storage:<br>
		{{ google|safe }}
		Microsoft Azure:<br>
		{{ azure|safe }}
		Amazon S3:<br>
		{{ aws|safe }}
		<script type="text/javascript">
			document.getElementsByName("google_upload_bucket")[0].checked = true;
			document.getElementsByName("azure_upload_container")[0].checked = true;
			document.getElementsByName("aws_upload_bucket")[0].checked = true;
		</script>
		</p>
		Select File:<br>
		<input type="file" id="file_path" multiple><br>
		<input type="button" onclick="UploadFile();" value="Upload">
		<progress id="progressBar" value="0" max="100"></progress>
		<span id="percentage"></span>
		<div id="information"></div>
		<div id="information_private_key"></div>
		{% endif %}
{% endblock %}
